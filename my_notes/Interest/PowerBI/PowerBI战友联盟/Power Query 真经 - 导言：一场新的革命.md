---
create_date: 2022-03-01T13:32:26 (UTC +08:00)
tags: 
aliases: null
pagetitle: Power Query 真经 - 导言：一场新的革命
source: https://mp.weixin.qq.com/s/Bci_4DK5kcWjDZr3fbTxUw
author: BI佐罗
status: 未阅读
category: 
notes: False
ZK: Origin
uid: 
---

## 0.1 数据分析师的常见场景

无论是进行基本的数据输入、建立简单的报告，还是使用 VBA、SQL 和其他语言设计全面的商业智能解决方案，都会在一定程度上与数据打交道。虽然需要的技能各不相同，但通常要完成的总体工作如下。

1.  从数据源中提取数据。
    
2.  根据实际需要对数据进行转换。
    
3.  纵向追加合并数据表。
    
4.  将多个数据表（链接）合并在一起。
    
5.  重塑数据结构，以便进行更好的分析。
    

作为信息工作者，无论在正式的工作描述中如何称呼，其角色都是 “收集数据”，“整理数据” 并将其转化为信息。这些工作可能并不高大上，但却是企业中必不可少的，如果这些工作没有正确地进行，任何分析的最终结果都是不可信的。

这项工作多年来选择的工具一直是 Microsoft 的 Excel。虽然像 Excel 这样的工具有强大的功能来帮助分析师处理数据，但将原始数据转换为可使用的数据，这一课题多年来一直是个挑战。事实上，很多人经常会在这个问题上花费大量的时间：为分析准备数据，将其转换为合理的表格形式，以便后续的分析和报告使用，如图 0-1 所示。

_图 0-1 在幕后，作为信息工作者，努力通过处理数据达到预期_

> Hard working Excel User ：努力工作的 Excel 用户
> 
> Transformed Into：转换成
> 
> Table suitable for Excel consumption：适合 Excel 使用的表格

对于那些做过类似工作的人来说，他们会知道，这其实不仅仅是信息工作者那么简单；更像是 “数据魔术师”。数据几乎不可能恰好是干净的；往往正相反，可能需要花费数小时 “清洗”、“过滤” 和 “重塑” 来使数据成为更合理的格式。

一旦数据准备就绪，就可以轻松地执行大量强大的分析过程。处理数据有很多方式来施展魔法，包括 “条件格式”、“筛选器”、“数据透视表”、“图表”、“切片器” 等。

当然，准备好干净的数据往往是最困难的部分。通常，起初得到的都是混乱的数据，它们被保存在 “文本文件” 和 “Excel 文件” 中存放数据（如果非常幸运的话，可能是一个数据库），分析师必须以某种方式清理这些数据，并使它们成为能够使用的合理格式。最终目标很简单：尽快将数据转换成表格格式，同时确保它符合实际的需求，并且是准确的。每个解决方案都需要不同来源的数据的不同组合，而这个过程就需要” 魔法 “，如图 0-2 所示。

_图 0-2 黑魔法：数据在被使用前真正发生的事情_

> Raw data in many shapes forms（from one or multiple sources）：多种形式的原始数据（来自一个或多个来源）
> 
> Magic Happens here（with Excel Formulas, VBA or Something else）：魔术发生在这里（使用 Excel 公式，VBA 或其他东西）
> 
> The result of our hard word （a table ready for consumption or analysis）：这是努力工作的结果（准备使用或分析的表）

## 0.2 “黑魔法” 的好处和危险

真正的 Excel 高手会使用许多不同的技术来实现他们的 “魔法”：有时单独使用，有时与其他工具结合使用。这些魔法的类型如下。

1.  Excel 公式：这是 “魔术师” 使用的首要技术。利用他们的公式知识，使用 VLOOKUP、INDEX、MATCH、OFFSET、LEFT、LEN、TRIM、CLEAN 等函数。虽然公式被大多数 Excel 用户使用，但公式的复杂性因用户的经验和水平而异。
    
2.  Visual Basic for Applications (VBA)： 这种强大的语言可以帮助用户对数据创建强大而动态的数据转换。VBA 技术往往被高级用户使用，因为真正掌握它们需要有一定的知识储备和技能。
    
3.  SQL 语句： SQL 是另一种用于操作数据的强大语言，它对于 “选择”、“排序”、“分组” 和 “转换数据” 非常有用。然而，现实情况是，这种语言通常也只有高级用户才会使用，甚至许多 Excel 专业人员都不知道从哪里开始使用它。尽管每个 Excel 专业人员都应该投入一些时间来学习它，但这种语言通常被认为是数据库专业人员的领域。
    

所有这些工具都有一些共同点：从本质上说，它们基本上是分析师唯一可用于数据清理和转换的工具。

尽管这些工具很有用，但其中也有两个严重的弱点：它们不仅需要花费大量时间来处理问题，还需要花费大量时间来掌握。

虽然懂的这些技术的 “魔术师” 确实可以使用这些工具来构建自动化解决方案，并把原始数据处理干净，但这需要学习多年高级编程语言经验，以及大量的时间来确定、开发、测试和维护解决方案。因为导入时数据格式的一个小变化就需要调整原有方案，或者增加一个新的数据来源也是十分可怕的，因为这些解决方案十分复杂。

在一个公司里有一个真正的 “魔法师” 存在其实反而是一个隐患，这个人可能的确会建立一个很牛的解决方案，甚至直到他离职后还在运行使用，但公司的其他人并不了解这个解决方案，当出现问题时，没有人可以搞定它。

从另一个角度看，许多负责数据清洗工作的人也没有时间，或没有机会学习这些先进的 “魔法技术”。虽然理论上的确可能有一个稳定的系统，在维护下不会出现崩溃的问题，但同时也会花费几个小时、几天、几周、几个月和几年的劳动时间和金钱，来定期进行重复的数据清理和导入。

可以计算一下，公司里每月有多少小时只是在 Excel 里执行重复的数据导入和清理任务。将这些时间乘以公司的平均工资，再按所处行业在世界范围内的公司数量，这不就算出了世界的整体成本吗？很容易发现，这种代价成本是惊人的。

所以需要一个更好的方法，一种容易学习的工具，其他人只需接受有限的指导就能掌握和理解。这种工具应该可以让用户自动导入和清理数据，这样用户就可以专注于将数据转化为信息，为公司增加真正的业务价值。

这个工具现在来了，他就是 Power Query 。

## 0.3 未来的改变

Power Query 解决了刚才描述的问题。它非常容易学习，并且拥有可能是史上最直观的用户界面。同时它也很容易维护，因为它显示了操作流程的每个步骤，还可以后续查看或修改。而且，在 Power Query 中完成的所有操作都可以通过点击几次鼠标来刷新。

在有了多年时间使用 “黑魔法” 技术构建数据解决方案的经验后，发现 Power Query 才是真正改变了游戏规则的工具，其中原因有很多，很明显的就是学习曲线立竿见影。

当涉及导入、清理和转换数据时，用户其实可以比学习 Excel 公式更快地掌握 Power Query，而且它比 VBA 更容易处理复杂的数据源，如图 0-3 所示。

_图 0-3 Power Query 被设计成一个易于使用的数据转换和操作工具_

> Benefits vs Time to Master the Tool：好处对比掌握工具所需时间
> 
> Benefits of the Tool：工具的好处
> 
> Time Needed to Master The Tool：掌握工具所需时间
> 
> Minutes：时间起点
> 
> Years：年
> 
> Power Query：Power Query
> 
> Excel Formulas：Excel 公式
> 
> Visual Baslc for Applications（VBA）：Visual Baslc for Applications（VBA）

Power Query 的易用性解决了许多企业面临的数据 “魔术师” 陷阱。即使一个高水平的数据 “魔术师” 在 Power Query 中做了一些复杂的设计，普通用户也可以在短时间内掌握并能够维护或进行修复，往往只需要几个小时，而不是几周。

尽管对于真正的 Excel 专业人士来说，这很难理解，但许多用户实际上并不想学习复杂的 Excel 公式。他们只是想用一个工具连接到他们的数据源，点击几个按钮来清理和导入数据，然后构建他们需要的图表或报告。正是这个原因，Power Query 的用户范围将比那些需要精通公式才能做事的用户范围更广。使用菜单驱动的界面，用户在很多情况下不需要学习任何一个公式或一行代码，如图 0-4 所示。

_图 0-4 Power Query 的易用性与任何经典方法相比都将影响更多的用户_

> Total Excel Users：总 Excel 用户量
> 
> Formulas：公式
> 
> VBA：VBA
> 
> SQL：SQL
> 
> Power Query Impact：Power Query 的影响力

毫无疑问，Power Query 将永远改变 Excel 专业人员处理数据的方式。

需要明确指出的是，这里并不是在贬低 Excel 公式、VBA 或 SQL 的价值。事实上，它们是分析师不能缺少的工具。在数据转换用途之外，Excel 公式可以快速使用，迅速完成许多 Power Query 做不到的事情。VBA 在性能方面也有它的优势，可以让分析师调用其他应用程序，创建程序来读写数据，以及做许多其他事情。而由 SQL 专家编写的 SQL 查询总是比 Power Query 创建的查询性能更好。

然而，在简单地连接、清理和导入数据的场景下，Power Query 依然有更高的性价比，使分析师以更少的时间投入更快地实现自动化。而且随着 Power Query 团队对工具的不断改进，SQL 专家和 Power Query 生成的查询之间的性能差距也在逐渐缩小。

其实，Power Query 是不局限在 Excel 中使用的。以前如果考虑在 Excel 中来实现清洗、转换和加载数据的功能，那么该功能就必须保留在 Excel 文件中，或者设计一种 Excel 外的全新语言来实现，这样的弊端是无法复用。但是 Power Query 很好地解决了复用问题，同样的 Power Query 技术在 Excel、Power BI 桌面版、Power Automate 和 Power BI Dataflows 中都可以使用。所以，在 Excel 中使用 Power Query 构建的一个解决方案，可以简单地将其导入到 Power BI 桌面版中，或者将其复制到 Power BI Dataflows 中进行复用。

除了创建可移植和可扩展的解决方案之外，这也意味着作为数据专业人士，可以学习一种新的可移植技能，并在各种不同的软件产品中多次重复使用。如果考虑未来的发展，也许 Power Query 还会超越目前这些范畴。

而且，由于 Power Query 与其他软件的集成性，就得到了更强大的效果。例如，可以用 Power Query 实现类似 SQL 查询，在 Excel 中用 VBA 刷新它，实现自动化；或者通过 Power BI 使用计划刷新功能，将 Power Query 查询直接加载到数据模型或实体中，等等。

## 0.4 为什么说 Power Query 有魔力

在构建强大而稳定的解决方案时，数据专家面临的首要问题是需要一个可以提取、清理和转换数据的 ETL（Extract Transform Load） 工具，但普通业务用户很可能从未听说过这些术语，如图 0-5 所示。

_图 0-5 ETL：提取、转换、加载_

> Extract：提取
> 
> Transform：转换
> 
> Load：加载

Power Query 可以认为就是一个 ETL 工具；他可以从几乎所有类型的数据源中提取数据，根据需要进行转换，然后加载。这对于要处理数据的业务用户来说又意味着什么呢？

### 0.4.1 提取

提取可以针对一个或多个数据源，包括：文本文件，CSV 文件，Excel 文件，数据库和网页页面。此外，Power Query 团队还建立了许多连接到不同数据源的连接器，这些数据源在其他情况下很难获得：Microsoft Exchange、Salesforce 和其他从未想过的”Software As A Service“（SAAS）数据源。当然，还有用于那些还没有被团队覆盖的数据库的 ODBC 和 OLEDB 连接器。无论数据现在存在哪里，都有很大的机会可以用 Power Query 提取和使用它。

### 0.4.2 转换

当谈论转换时，包括以下各个方面。

1.  数据清洗：包括从数据库中过滤数据，到从文本文件导入中删除空白或垃圾数据。其他用途包括将大写字母转换为小写字母，将数据拆分成多列，以及正确地导入不同地区使用的日期格式。无论需要对数据进行怎样地后期使用，首先都必须将数据进行清洗为干净的格式。
    
2.  数据整合：如果在 Excel 中使用 VLOOKUP、INDEX/MATCH 或较新的 XLOOKUP 公式，可能就是整合多个表的数据。Power Query 可以以垂直或水平方式连接表，允许纵向追加两个表（创建一个长表），或水平合并表（无需写 VLOOKUP 函数）。还可以执行其他操作，如分组等。
    
3.  数据增强：包括添加新列或对一组数据进行计算。从执行数学计算，如通过 “销售数量 \* 销售价格” 创建 “销售总额”，到根据 “交易日期” 列添加新的 “日期格式”，这些在 Power Query 中都变得非常简单。事实上，通过 Power Query，甚至可以根据 Excel 单元格、SQL 数据集甚至网页中的值来动态地创建整个表。需要一个从今天算起的五年前的动态日历表吗？只需要进一步的使用 Power Query 即可。
    

Power Query 真正令人惊讶的是，许多转换可以通过菜单命令来执行，而不需要写公式或代码来完成。这个工具是为终端用户建立的，不需要任何编码经验，就可以执行在 SQL 或 VBA 中无比复杂的转换。这是一件很棒的事情。

不过，对于那种喜欢躲起来，捣鼓公式或代码的人来说，一样可以得到满足。虽然不需要学习编程，但可以了解 Power Query 内部用一种叫做 “M” 的语言记录一切（开玩笑说，A 到 L 语言命名已经都被占用了，所以轮到了 M）（译者注：M 语言的 M 是 Mashup 的简称，Mashup 意思是混合，意为将数据有效地混合到一起）。而对于那些决定利用这种语言的专业人员来说，可以建立更有效的查询，做更多惊人的事情。

无代码、低代码或专业代码：选项完全取决于用户。但无论选择哪种方式，至少在无代码世界中能做这么多事情是很震撼的。

### 0.4.3 加载

由于每个支持 Power Query 的工具都有不同的用途，可以把数据加载到的地方也会不同。

1.  Excel：加载到 Excel 中的表（译者注：很多地方俗称 “智能表”），Power Pivot 数据模型，或者只保持连接而不加载数据 。
    
2.  Power BI：加载到数据模型，或只保持连接而不加载数据。
    
3.  Power Automate (Flow)：加载到 Excel 工作簿（预计将来会有更多加载选项）。
    
4.  Dataflows：加载到 Azure Data Lake Storage、Dataverse，或只保持连接而不加载数据 。
    

“连接” 可能看起来有点神秘，但它只是意味着可以创建一个可以被其他查询再进一步使用的查询，本书后文会更充分地探讨它的使用。

数据的加载位置并不是这个 ETL 工具中加载过程的重要部分，重要的是它是如何加载，以及如何再次加载的。

Power Query 本质上是一个宏记录器，当用户通过提取和转换步骤工作时，它可以跟踪用户操作过的每个步骤。这意味着用户只需定义一次查询，并确定想把它加载到哪里。在完成这些之后，只需要刷新查询，如图 0-6 所示。

![图片](https://mmbiz.qpic.cn/mmbiz_png/09hv4Xua0LNPHIE8FHGOwYNFDt4yLo6NuoJnaOoPFrphBIUBmo4qfJYsiaxfJibiauWTMyPHXpgNEzxia81WQClk3g/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

_图 0-6 定义一次转换过程并随时使用_

> Define once：定义一次
> 
> Consume anytime：随时使用

请考虑一下这个问题。导入文本（.TXT）文件，这个文件在过去需要花 20 分钟来导入和清洗，然后才可以使用它。Power Query 使之变得简单，在 10 分钟内完成同样的任务，在第一次使用它时就节省了 10 分钟。然后下个月来，刷新一下，就直接有了一个新文件。

至此，不难发现用户不会像以前一样卷起袖子，搞 20 分钟的 Excel 盛宴，向 Excel 展示自己是可以搞定它的大师，每月不停的重复重复再重复。这种改变，难道不令人兴奋吗？

在这种情况下，只要把新的（.TXT）文件保存覆盖旧的文件，然后在 Excel 中点击【数据】【刷新所有】（或者在 Power BI 中点击【主页】【刷新】）就可以完成所有工作，这可是认真的。如果用户已经把文件发布到 Power BI 或者在 Power BI Dataflows 中设置了它，还可以直接安排定时刷新来避免这些麻烦。

这就是 Power Query 的真正力量。易于使用，易于重复使用。它把用户的辛苦工作变成了一种投资，并在下一周期为用户腾出时间来做更有价值的事情。

## 0.5 Power Query 和产品体验的整合

Power Query 是一项正在改变世界的技术。早在 2013 年，它就作为一个 COM 插件正式开始在 Excel 中使用，现在它已经在超过 8 种不同的产品中使用，从 Excel 和 Power BI 桌面版，到 SQL Server Integration Services，Azure Data Factory，并且就在阅读本书时，可能已经又被集成到新的数据相关产品中了。

Power Query 所产生的影响力是惊人的，它极大地改变了许多不同软件产品的数据分析师的生活。当然，被集成到这么多产品中也是是有代价的，Power Query 团队每天面临的困难是在所有这些产品的集成中寻求一种平衡：功能和体验。他们必须在一致性和承载 Power Query 功能的产品所特有的功能之间找到最佳平衡点。

### 0.5.1 Power Query 的组件

为了便于理解，可以把 Power Query 想象成一个 “洋葱”，它有很多层，这些层实际上是组成 Power Query 的核心组件 。

大多数人们观察事物时，都只是看到事物的表面。随着本书的进展，就会发现在 Power Query 背后发生的很多事情。这里的 M 代码对于用户来说是可见的，但是可能永远不会看到 M 引擎。快速浏览一下 Power Query 这个 “洋葱”，如图 0-7 所示。

_图 0-7 Power Query 的层次结构_

> M Engine：M 引擎
> 
> M Query：M 查询
> 
> Power Query User Interface：Power Query 用户界面

在 Power Query 中总共有三个可能的层，但有些产品的集成可能只有前两个层，这些层如下。

M 引擎：底层查询执行引擎，运行用 Power Query 的公式语言 M 表达式（M 函数与操作符的运算）的查询。

M 查询：用 Power Query M 公式语言编写的一组命令。

Power Query 用户界面：也被称为 Power Query 编辑器，作为一个图形用户界面，帮助用户进行操作，但不限于如下 3 个方面。

1.  通过与用户界面的简单交互，创建或修改 M 查询。
    
2.  将查询和其结果可视化。
    
3.  通过创建查询组、添加元数据等管理查询。
    

（译者注：M 函数，M 语言，M 表达式，M 查询含义类似，都是 M 函数不同程度的组合使用，在文中不同场景不必拘泥于用词，具体以上下文来体会含义。）

在最低限度上，一个产品至少集成有 M 引擎和 M 查询这两层。从表 0-1 中不难看出，并不是每个产品集成都会包含 Power Query “洋葱” 的所有三层。

| 产品 | M 引擎 | M 查询 | Power Query 用户界面 |
| --- | --- | --- | --- |
| Excel | 是 | 是 | 是 |
| Power BI 桌面版 | 是 | 是 | 是 |
| Power BI Dataflows | 是 | 是 | 是 |
| SQL Server Integration Services | 是 | 是 | 否 |

_表 0-1 并非所有集成 Power Query 的工具都包含其所有三层组件_

### 0.5.2 产品体验的整合

如果在 2021 年上半年，比较 Power Query 在 Excel 和 Power BI Dataflows 中的体验，的确可能注意到一些差异，如：Power BI Dataflows 利用了 Power Query 在线版的用户界面，而 Excel 和 Power BI 的体验则是基于 Power Query 桌面版的用户界面。虽然用户界面确实有差异，但使用它们的基本过程是相似的。

如果在 2024 年第一季度再来比较，可能会发现这些差距没有以前那么大了。这主要是因为 Power Query 团队正在努力为 Power Query 用户界面提供一个一致和统一的核心体验，然后所有的用户体验和产品使用都是一致的。

当然，植入 Power Query 的不同产品可能仍然有一些独特的功能。例如直接从 Excel 活动工作表中获取数据，这就是在 Excel 中的 Power Query 独有的，但在所有这些产品中，核心的体验是基本一致的。其中一些差异来自 M 引擎、M 代码或 Power Query 用户界面层的差异，而另一些差异可能只是用户界面之类的东西（例如：不同的体验可能只是图标的不同）。

可以肯定的是，在过去几年中，微软已经投入了大量的资金来推动 Power Query 在线版的体验和发展。一旦进行了足够的迭代和测试，就会将这些功能转移到 Power Query 桌面版体验中进行预览，然后再进行最终地全面发布。也就是说，如果想尝试 Power Query 的 “最新” 和 “最好” 的功能，推荐使用 Power Query 在线版体验，通过 Power BI Dataflows 等产品可以来体验这些。

这个工具无论是功能还是用户界面的变化都发展很快，这已经不是什么新鲜事了。由于这一事实，得出的结论是，写一本关于 Power Query 的书，并附上用户界面的截图，但使截图保持最新，是根本不可能的。事实上，这本书的发布被推迟了两年，因为在等待一个 Excel 中用户界面的变化。

本书提供了大量的点击操作步骤，但读者应该认识到，实际需要采取的操作步骤可能略微会有所不同 —— 无论是产品体验还是用户界面发生的变化，都可能会影响到实际操作的步骤。但不会改变的是这些案例背后的目标、理论或方案。这就是本书的核心：如何掌握数据本身，而不要局限于所看到的具体用户界面。只有通过这种方式，才能够实现本书的使命，即一本能够在未来几年内都可以使用的书。

## 0.6 Power Query 的更新周期

在正式开始使用 Power Query 之前，先来了解下这个工具的更新问题。这似乎是本末倒置，但这是有原因的。

Power Query 团队每月都会发布更新。这里不是指对 Bug 的修复（尽管肯定包括这些在内），这里说的是新功能和性能增强。虽然有些变化很小，但有些变化也可能很大。在 2015 年初，Power Query 发布了一个更新，将查询加载时间缩短了 30%。在 2015 年 7 月，继续发布新版本，解决了 Power Pivot 刷新时遇到的一些非常严重的问题。在随后的几年里，还发布了 “连接类型”、“条件列” 和更多内容，特别是在过去的三年里，还发布了从示例中分析列（译者注：如 Web 查询的表列推测）和模糊匹配，以及其他新功能。

那么，到底如何安装使用 Power Query 的呢？答案是，这取决于使用 Power Query 的场景和目的。

### 0.6.1 Power Query 在线版

Power Query 在线版是指在如 Power Automate、Power BI Dataflows 等工具中以在线体验方式使用 Power Query。这些都是基于 Web（互联网应用） 的服务，用户不需要对它们进行任何更新。修复和新功能是持续发布的，用户只需要每隔一段时间查看一下，增加了什么新东西。

### 0.6.2 Microsoft 365

用户使用 Excel（或任何其他 Office 产品）的首选方式是通过 Microsoft 365 订阅。如果是订阅用户，软件就会根据 Office 版本所使用的 “渠道”，定期自动更新功能和进行 Bug 的修复。

> 【提示】
> 
> 可以在 Microsoft 的 office365 官网了解到这方面的更多信息。

### 0.6.3 Excel 2016/2019/2021

Power Query 是一个正在不断发展的产品。如果回顾一下 Excel 2016（最初于 2015 年 9 月发布），最终将 Power Query 集成到了这个版本 Excel，但它的确存在一些问题，“连接类型”、“条件列” 和 “从示例列” 功能在那时还没有发布。

好消息是，尽管 Excel 2016 和 2019 产品不是订购模式，但它们在最初发布后也有一些 Power Query 的更新。当然这里强烈建议用更新版本的软件来获得与本书案例一致的体验。

在系统中上获得这些更新的技巧是，确保操作系统在下载其 Windows 更新时也能获得【其他 Microsoft 产品的更新】。要在 Windows 10 / 11 中检查这一设置，包含以下四个步骤。

1.  按【Windows】键并输入 Windows。
    
2.  选择【Windows 更新设置】。
    
3.  转到【高级选项】。
    
4.  找到【更新 Windows 时接收其他 Microsoft 产品的更新】打开下面的按钮（显示 “关” 字则表示按钮已打开）。
    

### 0.6.4 Excel 2010 & 2013

在 Excel 2016 或更高版本中， Power Query 被内置为产品的一部分，而 Excel 2010 & 2013 必须从 Microsoft 官网下载中心手动下载和安装。Excel 2010 & 2013 的最终更新是在 2019 年 3 月发布的。

### 0.6.5 Power BI 桌面版

Power BI 桌面版有两种安装路径。如果通过 Microsoft 商店安装它，那么它将自动更新。另一方面，如果通过 Microsoft Power BI 官网下载和安装它，将需要手动下载和安装更新。

> 【注意】
> 
> Power BI 最酷的地方在于，这是用户可以看到新的 Power Query 发布的最早地方。它们通常隐藏在 Power BI 的【选项和设置】功能下面【选项】窗口中的【预览功能】选项卡下面。但如果想看看 Excel 会有什么新功能，也可以在预览功能选项卡下查看。新功能通常先发布在 Power BI 桌面版上，然后在 Power BI 桌面版上达到正式发布状态（不再是预览状态）的 2、3 个月后再发布到 Excel 中。

## 0.7 如何使用这本书

无论读者是 Power Query 工具的新手还是经验丰富的 ETL 专业人士，本书旨在从实用的角度成为理解 Power Query 和 M 语言的首选资源。这里的目标是解决日常影响用户的常见问题，并展示如何使用 Power Query 来解决这些问题。书中还将介绍一些更高级的场景，将 Power Query 和 M 语言的最佳实践贯穿其中，以帮助用户不仅了解如何建立 Power Query 解决方案，而且了解如何使它们更好用。

本书中使用的绝大多数场景、插图和案例都将使用 Microsoft 365 版本的 Excel 进行展示。除非另有说明，图示的场景在 Excel 或 Power BI 中都可以使用。

### 0.7.1 Power Query 功能在哪里

使用 Power Query 功能的关键是要知道从哪里开始。

### 0.7.1 Excel 365

在作为 Microsoft 365 产品的一部分发布的 Excel 版本中（通常被称为 Excel 365 ），Power Query 的命令可以在【数据】选项卡的【获取和转换数据】中找到。虽然有更快捷方式来获取常见的数据源，但可以在【获取数据】按钮下找到所有可用的 Power Query 数据源，如图 0-8 所示。

![图片](https://mmbiz.qpic.cn/mmbiz_png/09hv4Xua0LNPHIE8FHGOwYNFDt4yLo6NiatfqruG7RVPYiblJGlRfZltFwh5MW3wSGNUbUtI8QibLSeBhRyOHmysg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

_图 0-8 在 Excel 中找到 Power Query_

### 0.7.3 Power BI 桌面版

在 Power BI 桌面版中，甚至不需要离开【主页】选项卡。直接点击那个巨大的【获取数据】按钮即可，如图 0-9 所示。

_图 0-9 在 Power BI 桌面版中找到进入 Power Query 的路径_

### 0.7.4 以前的 Excel 版本

虽然本书的重点是 Microsoft 365 版本的 Excel，但它的大部分功能都与早期版本兼容。不过需要认识到的是，该功能可能在不同的 Excel 选项卡下。

1.  Excel 2019：在大多数情况下，Excel 2019 基本与 Excel 365 相似。本书的图片中基于 Excel 365 截取。
    
2.  Excel 2016：与 Office 2019/365 一样，Power Query 的入口点在【数据】选项卡下，但会在【新建查询】按钮下找到它们（在 【数据】选项卡的中间），而不是在本书图片中看到的【获取数据】按钮下。
    
3.  Excel 2010/2013：一旦下载安装程序后，会发现在最上面的选项卡栏已经有一个单独的 Power Query 选项卡。书中的步骤会告诉去【数据】选项卡上的【获取数据】按钮的所有操作，都需要去【Power Query】选项卡上找到这些命令。
    

### 0.7.5 点击【获取数据】按钮

Power Query 可以连接到各种各样的数据源，可以通过点击 Excel 中【数据】选项卡下的【获取数据】按钮或 Power BI 桌面版中的【主页】选项卡下的【获取数据】按钮来操作这些数据。虽然 Excel 的数据源在菜单子文件夹中进行了分类，但想要在 Power BI 桌面版中看到子分类列表，需要点击【更多】按钮。

为了保持一致性，本书将使用以下方法来描述如何连接到 CSV 文件。

1.  创建一个新的查询【从文件】【从文本 / CSV】。
    

实际的 Excel 点击路径将是：

2.  转到【数据】选项卡，【获取数据】【自文件】【自文本 / CSV】。
    

这相当于 Power BI 桌面版中的以下操作：

3.  转到【主页】选项卡【获取数据】【更多】【文件】【文本 / CSV】。
    

如果还在使用 Excel 2016 或更早的版本，这些点击步骤将如下所示：

4.  Excel 2016：转到【数据】选项卡【新查询】【从文件】【从文本 / CSV】。
    
5.  Excel 2010/2013：转到 【Power Query】 选项卡【从文件】【从文本 / CSV】。
    

### 0.7.6 特殊元素

本书会给出一些带有：注意，提示的段落来提醒读者一些特别的事项。

注意，将出现在一个有 “【注意】” 提示词的段落中。这些段落指出了一些特殊的功能，用法或技巧，有助于提高使用 Power Query 的工作效率。

警告，将出现在一个有 “【警告】” 提示词的段落中。忽视这些警告会带来危险，因为它们指出了潜在的陷阱和问题，读者应该注意这些问题。

在进一步阅读之前，强烈建议读者下载本书中使用的所有案例，以便读者能跟随本书边学边练。

现在是时候深入探索这个神奇的工具了，开始吧。

**Power Query 真经连载**

[

开始学习 Power Query 真经

2022-02-25



](https://mp.weixin.qq.com/s?__biz=MzI1MDA4MzcxMA==&mid=2650791937&idx=1&sn=e4ed2f9edcc0048ded16b246a3f8c512&chksm=f18ce010c6fb69062075ee8b9e4e38072e12189a90095ab2d9b02877f870533ec8fb85cfbb95&scene=21#wechat_redirect)

[

Power Query 真经 - 前言

2022-02-28



](https://mp.weixin.qq.com/s?__biz=MzI1MDA4MzcxMA==&mid=2650791950&idx=1&sn=bc3e8ad6a5227ec65ab6bfab127d3797&chksm=f18ce01fc6fb6909bfcb46566f6bc442e9d983449936db9c43baf9a140a492124b2f1a430b03&scene=21#wechat_redirect)

**Power BI 终极系列课程《BI真经》**

[

![图片](https://mmbiz.qpic.cn/mmbiz_jpg/09hv4Xua0LNBM1lxlQYHJBicic4CvPoRGLqHgdTZOr8goNRh0asDXA48mRDzc9zxW4UMQiayHwgDmx7mlt4cQxtjg/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

BI真经 - 让数据真正成为你的力量





](http://mp.weixin.qq.com/s?__biz=MzI1MDA4MzcxMA==&mid=2650788512&idx=1&sn=76972ff4b0cf265fe9479c6457b04b47&chksm=f18cd2b1c6fb5ba7386eb0bb835280bd8a651bfe0481cc78f20fc30b80c60d2d4cb7eb5b1e3e&scene=21#wechat_redirect)

扫码与精英一起讨论 Power BI，验证码：data2022  
扫码与精英一起讨论 Power Query，验证码：PQ真经

![图片](https://mmbiz.qpic.cn/mmbiz_png/09hv4Xua0LOiad5BOrdQTKpB733esKiaxZa53LXWIPlQicMjxntaRr3a2hnMmuibTib8QacXeiakucDr7lSNGkuV2MXw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

点击“阅读原文”进入学习中心

**↙**
