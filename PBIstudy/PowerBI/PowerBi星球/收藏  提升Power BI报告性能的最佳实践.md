---
create_date: 2021-03-30T20:12:47 (UTC +08:00)
tags:
aliases:
pagetitle: 收藏 | 提升Power BI报告性能的最佳实践
source: https://mp.weixin.qq.com/s/oixYAHdM8fWHOJdwV65jmQ
author:
status: 未阅读
category:
notes: false
ZK: Origin
uid:
---

如何高效的使用PowerBI，如何优化报告，之前曾写过一个[简易的清单](http://mp.weixin.qq.com/s?__biz=MzA4MzQwMjY4MA==&mid=2484068752&idx=1&sn=62c4c72cda7e80a3c85fcc77a9f904a7&chksm=8e0c4b47b97bc251823d5b22e08966e57892a337468f07b92537da3519a1a2bc43017a2c2db2&scene=21#wechat_redirect)，最近在浏览国外的博客时，看到了Data Pears中的一篇文章，作者Mara是微软云解决方案架构师，实践经验丰富，关于PowerBI报告设计各个流程、各个步骤的最佳做法，介绍的非常详细，这里分享给大家，建议收藏并经常打开看看，一定会对你有所帮助。

其实不仅仅是当你的报告变得臃肿而缓慢时，才想着去如何优化，而是在设计之初、在制作的各个流程各个步骤，都应该尽量遵循这些最佳的做法，以防止最后做出来的报告差强人意。

原博链接：

https://www.datapears.com/post/power-bi-report-performance-best-practices

译文如下，感谢Mara Pereira分享~

___

**PowerBI报告性能的最佳实践**

Mara Pereira

为什么我的报告慢？我该怎么做才能防止报告变慢？

我经常听到这些问题，事实是，没有灵丹妙药。如果您已经构建了报告，但发现性能不如您预期的那么好，则可能有多种原因。在这种情况下，重要的是要了解问题的根本原因，因为这是快速解决问题的唯一方法。

在此博客文章中，我们将重点关注第二个问题：**我该怎么做才能防止我的报告变慢？**

即使我们将重点放在报告开发的最佳实践上，也可以将其应用于流程的任何阶段，包括存在性能问题的现有报告。

在我们探讨最佳实践之前，我想向您介绍我的Power BI Report Development 101流程图：

![图片](https://mmbiz.qpic.cn/mmbiz_jpg/aHEbZtANQJNJaqtHF4wfM2wpc2Jicwfsn8tkU5N1qPKVQW5bvFyvzeere4kEgnqP67AwibvnHbtkvYUjUpmGBicGw/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

通过此流程图，我尝试总结了在Power BI中开发报表所通常采取的步骤，这些总体步骤是：

> **1\. 分析数据并建立数据模型**
> 
> **2\. 报告设计**
> 
> **3\. 准备分享您的报告**
> 
> **4\. 分享您的报告**

在每个步骤中，我都包含了通常需要执行的较小步骤。

您可能会注意到上图中，我的步骤中不同的颜色。这是因为我根据情况将某些步骤视为可选步骤（请检查流程图图例）。我不打算具体讨论此流程图的细节，也许是另一篇博客文章的主题：）

在发布过程中，我将遵循此流程图中的逻辑，并与您分享一些如果您要确保报告运行良好就应该在每个步骤中都应考虑的事项。

> **1.分析数据并建立您的数据模型**

**需求收集**

了解问题/要求

第一步通常被忽略。在不完全了解您要解决的业务问题的情况下生成报告就像驾驶没有GPS的汽车一样。如果您不知道要去的地方，很可能您可能会与原本应该去的地方完全不同。

了解您的观众

借助Power BI，在很短的时间内创建报告确实非常容易，但是如果您不了解您的受众以及他们的期望是什么，那么您将很难找到一个能够满足他们需求的解决方案。例如，为C级用户创建的报告将不同于为分析人员创建的报告。执行报告的水平往往更高。

了解您的数据

了解您将在报告中使用的数据对于任何成功的项目都是至关重要的。问自己一些问题，例如：我需要/拥有哪些数据？数据模型将是什么样？我了解表格、指标吗？数据是否清理干净并且状态良好，是否可以生成我需要的报告？

定义成功标准

对于您的业务涉众和最终用户而言，成功的报告是什么样的？ 

定义报告项目的成功标准将使您能够调整所有先前的步骤。此外，通常您会与最终用户和利益相关者进入一个看起来像是“无限循环”的讨论，其中涉及细微的变化，包括报告中的新功能，新的KPI，视图等。拥有明确定义的成功标准将使您能够更轻松地关闭“反馈的无限循环”。

**连接数据**

确定将用于数据源的连接模式是构建Power BI数据模型时要经历的第一步。您应该花时间在可以优化数据模型性能的解决方案上。

检查我通常遵循的“规则”下方的图像，以决定是否要使用导入、Direct Query或实时连接：

![图片](https://mmbiz.qpic.cn/mmbiz_jpg/aHEbZtANQJNJaqtHF4wfM2wpc2JicwfsnB28gWQAjgU5s1CULVickd2EySHEN7aFz4XZLDhNQ8jSlibz0ibBLh9RFQ/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

**导入模式–数据模型过大（> 1GB）时该怎么办？**

有时候，您的数据模型会变得很大，而您仍然希望使用导入模式。以下是一些可以帮助您在这些情况下提高性能的选项：

-   考虑使用数据流+共享数据集
    
-   考虑使用复合模型
    
-   使用参数过滤大表并减少加载的数据量
    
-   考虑使用增量刷新
    
-   对于非常大的数据集，请考虑为最常见的报告场景创建模型的子集（也考虑使用复合模型）
    

通常，利益相关者/用户会要求在报告中拥有最大数量的数据，并要求近实时地对其进行刷新。 

多数情况下，仅导入必要的字段和表。如果源数据仅每周刷新一次，则每天刷新Power BI报表不会为您的解决方案或最终用户带来任何价值。

**连接数据时如何提高性能？**

-   仅导入必要的字段和表
    
-   集中 vs 部门/个人数据源：应尽可能避免使用部门/个人数据源
    
-   在可行的情况下尽量减少对Excel，csv和文本文件的使用-检查项目是否足够大以围绕将数据放入数据库中创建用例
    
-   在可行时使用关系数据库源-更快，更清洁，更易于处理 
    
-   在支持本机查询和过滤器的数据源（例如SQL Server）上优先连接
    
-   将尽可能多的处理委托给数据源
    
-   禁用后台数据
    
-   如果安全，请禁用隐私设置或将两个来源都设置为“组织性”
    
-   在开发过程中定期测试Power BI服务中的数据刷新 
    

**转换数据**

转换数据时如何提高性能？

利用查询折叠

将过滤器步骤放在行保持步骤之前-下推到源代码的操作通常更快

过滤掉不必要的列和行

始终从生成报告所需的最少数据开始。这包括删除相关表中的冗余列，以及删除包含从其他列中计算出的值的列

以高精度和基数减少长列的使用

例如，带有小数位，长文本，日期/时间的列…列包含的唯一值越多，压缩效率越低。考虑减少小数位数，在两个单独的列中拆分日期和时间

关闭自动日期时间

自动日期时间会创建许多内部日期表，这些表在较小的模型中可能会有显著的影响

处理脏数据、错误数据

避免进行扫描整个表（如联接等）的转换

如果未折叠，则需要将整个表加载到内存中，然后再进行下一步–考虑改用DAX措施

不要加载中间查询

使用仅用作中间查询的表时，请禁用数据加载

分组并汇总

加载预先汇总的数据

如果使用的是Direct Query模式，则应遵循前面提到的最佳实践，但也应遵循以下最佳实践，这些最佳做法专门适用于使用Direct Query连接到源的查询：

避免复杂的Power Query查询

通过消除对Power Query查询进行任何转换的需求，可以实现有效的模型设计。这意味着每个查询都映射到单个关系数据库源表或视图

检查计算列和数据类型更改的使用

Direct Query模型支持添加计算和Power Query步骤以转换数据类型。但是，在可能的情况下，通常可以通过在关系数据库源中实现转换结果来实现更好的性能。

不要使用Power Query相对日期过滤

这种类型的过滤器会转化为效率低下的本地查询

限制并行查询

您可以设置直接查询为每个基础数据源打开的最大连接数。它控制并发发送到数据源的查询数

**建立您的数据模型**

构建数据模型时如何提高性能？

关系调优

-   确保表具有关系
    
-   有目的地验证和使用非活动关系
    
-   避免与高基数列建立双向关系
    
-   避免过度的双向或多对多关系
    
-   多对多关系应该是单向的
    
-   建立星型模型，避免雪花模型
    

建模调整

-   隐藏所有用户不直接使用的字段
    
-   模型应有一个日期表
    
-   减少计算列数
    
-   减少对计算表的使用
    
-   优化列数据类型和精度
    
-   关闭列层次结构（IsAvailableInMDX列属性）
    

使用Direct Query连接模式时，还应考虑以下几点：

避免在计算列上建立关系

计算表达式将嵌入到源查询中。它不仅效率低下，而且通常会阻止索引的使用

设置关系以加强完整性

Direct Query 关系的“假定参照完整性”属性确定Power BI是否将使用内部联接而不是外部联接来生成源查询

检查计算列和数据类型更改的使用

在可能的情况下，通常可以通过在关系数据库源中实现转换结果来实现更好的性能

**DAX**

建立DAX度量值时如何提高性能？

性能调优

-   尽可能使用DAX变量
    
-   尽量避免使用DAX迭代器功能（例如sumx，averagex ...）
    
-   除法应使用DIVIDE函数
    
-   尽可能使用度量值而不是计算列
    

可用性调整

-   将所有度量值存储在单独的表中
    
-   以有意义的方式命名度量值：避免在列和度量的名称中含糊不清
    
-   将所有货币和十进制小数格式设置为已定义的标准（例如2位小数，千位分隔符）
    
-   使用显式度量，而不是隐式度量。简而言之，隐式度量是自动分配汇总的度量，例如Power BI的Sum或Count。
    

> **2.报表设计**

设计层面

-   使用模板（.PBIT文件）来加速和标准化报告开发，而不是从空的.PBIX开始
    
-   重点关注最终用户的报告可用性
    
-   在设计阶段初期解决可访问性
    
-   仔细查看显示的数据，以评估是否容易被误解
    

如何呈现信息

-   使用仔细的放置和清晰的层次结构在页面上显示信息
    
-   对每个页面以及每个页面上的每个图表都有特定的用途
    
-   与出现在多页上的项目的位置保持一致
    
-   使用重点讲故事的版式
    
-   避免页面混乱，使报告使用者集中精力于重要事项
    
-   对数据使用正确的可视化（饼图，甜甜圈图，仪表图和其他圆形图类型不是数据可视化的最佳做法）
    
-   使用遵循可视化最佳做法和公司品牌准则的调色板
    
-   使用清晰的标题，标签和描述
    
-   使用书签创建“帮助”信息以指导用户
    

性能调优

-   避免密集的报告页面，旨在最大程度地减少页面上显示的数据量和视觉效果的数量
    
-   避免使用包含数百列和数千行的表的“数据转储”样式的报告。通常是在用户希望将此数据导出到Excel时创建的。如果用户打算将数据导出到Excel，请考虑直接在Excel中设计报表以提供所需的数据，但要与数据集进行实时连接  
    
-   考虑在报表中使用切片器和过滤器，以允许用户仅选择需要随时显示的数据。  
    
-   在报表发布时设置切片器或过滤器，以便报表的初始呈现可以令人满意地执行  
    
-   考虑在报表中添加一个“应用过滤器”按钮，以使您的视觉效果不会在每次更改页面中的过滤器时自动更新（对直接查询特别有用！）  
    
-   考虑使用诸如书签，追溯页面和工具提示之类的技术来减少页面上显示的数据量  
    
-   选择合适的视觉对象  
    
-   专注于其传达信息的能力，抵制仅出于美学吸引力而使用多种视觉类型的冲动 
    
-   仅使用您信任的来源的自定义视觉效果-最好经过认证  
    
-   测试报告页面中的自定义外观，以确保快速加载报告  
    
-   更改视觉效果之间的交互-视觉对象不必要的交互会使您的报表运行缓慢（对于Direct Query特别有用！）
    
-   启用行级安全性-使用RLS，仅导入用户有权查看的数据
    

> **3.准备分享您的报告**

**行级安全性**

RLS的工作原理是将过滤器自动应用于每个DAX查询，这些过滤器可能会对查询性能产生负面影响。因此，有效的RLS取决于良好的模型设计（请参阅“分析数据并构建数据模型”部分）。

-   通常，在维度表而不是事实表上强制实施RLS筛选器通常更有效
    
-   依靠精心设计的关系来确保RLS筛选器传播到模型中的其他表 
    
-   当通过模型关系可以达到相同的结果时，避免使用LOOKUPVALUE DAX函数
    
-   避免使用复杂的RLS规则
    
-   当在Direct Query表上强制使用RLS筛选器并且与其他Direct Query表存在关系时，请确保优化源数据库
    

**问答**

通过问答进行查询的性能将直接取决于您先前为提高数据模型性能所做的所有工作。

有很多关于问答的最佳实践（命名约定，同义词等），我们将不在本文中讨论。

> **4.分享您的报告**

**设置数据网关**

使用企业数据网关而不是个人网关

Personal Gateway接收数据并将其导入Power BI。企业网关（本地数据网关）不导入任何内容，这在处理大型数据库时效率更高

使用不同的Power BI网关进行计划刷新和Direct Query

如果计划的数据刷新和Direct Query使用相同的网关，则当计划的数据刷新处于活动状态时，Direct Query性能将降低

**安排数据刷新**

计划数据刷新

如果可能，启用增量刷新

使用增量刷新，只需刷新已更改的数据。较少的数据刷新可减少内存和其他资源的总体消耗。

仔细分析数据刷新的频率

用户可能希望数据集每天刷新48次，但是如果您的数据源每天仅刷新1次，则刷新频率高于此频率不会给您的解决方案带来任何价值 

考虑数据集的刷新时间

您可能希望在“安静”的时间安排刷新，以确保与其他报告的并发刷新不多

其他相关最佳做法

将用户添加到Office或Azure Active Directory组中，然后使用组共享报告内容

如果您使用的是基于角色的安全性或行级安全性，请使用组来管理角色成员身份

考虑升级/认证您的数据集，以便组织中的其他人可以重用它。这样可以避免大量的数据集重复

确保Power BI报表和数据源位于同一区域

在租户和数据源位于同一区域的情况下，您可以减少网络延迟。结果是更快的数据传输和更快的查询执行。

即使这篇博客文章看起来已经很长，但我非常确定还有很多最佳实践是我还不曾想到的，因此，我将尽力使这篇文章保持更新:)

the end

___

\-精彩推荐-

[![图片](https://mmbiz.qpic.cn/mmbiz_jpg/aHEbZtANQJOojexubCy39PJZJic24XlI9IC8Fhx57SVYiciave3T7sAxeLXXZgrAzhAsUHXC3dxpU1fp72ChD8ibfw/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)](http://mp.weixin.qq.com/s?__biz=MzA4MzQwMjY4MA==&mid=2484074255&idx=1&sn=0c183ee84fd7fcc4e9dfb6baf39580c0&chksm=8e0c5dd8b97bd4ce1a617be83fe88938a0ba49668102ca3d10794c0e530f38c2950df75cf2ee&scene=21#wechat_redirect)

[![图片](https://mmbiz.qpic.cn/mmbiz_jpg/aHEbZtANQJP8Cvmfx7v8oUqdoQaMmuDAG2GibhzIydz7aGIyMr9drbJx6vevzfXib5D6NFtuR4Qu3TVQibQRqrVWg/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)](http://mp.weixin.qq.com/s?__biz=MzA4MzQwMjY4MA==&mid=2484072351&idx=1&sn=fabb08c54790ac1225b470fd647c7a5e&chksm=8e0c4548b97bcc5e0450f1945a2c76039bbb42650bcb1edbc856820836d63d32af4c7780e31a&scene=21#wechat_redirect)

[![图片](https://mmbiz.qpic.cn/mmbiz_jpg/aHEbZtANQJMst6LMfyIX5sg2QmEtLfjxR5h1x8nrN7ibw97H9HjLSB59iaf2JLMtwY8OUcKiacK35ybYfpaoVNuGQ/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)](http://mp.weixin.qq.com/s?__biz=MzA4MzQwMjY4MA==&mid=2484071399&idx=1&sn=44b4ba20c1cbe657f77b6c8d144b2b30&chksm=8e0c4130b97bc826d87746723f940404ce82ac9ebb38572bbfb1a89d7a48aaa750dffd92a28d&scene=21#wechat_redirect)
